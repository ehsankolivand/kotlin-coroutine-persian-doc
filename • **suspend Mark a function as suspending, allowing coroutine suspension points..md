

# آشنایی با کلمه کلیدی `suspend` در کوروتین‌های کاتلین

  

کلمه کلیدی `suspend` در کاتلین بخشی از برنامه‌نویسی غیرمسدودکننده با استفاده از کوروتین‌هاست. این کلمه امکان توقف (pause) و از سرگیری (resume) اجرای یک تابع را بدون مسدود کردن ترد فراهم می‌کند و به مدیریت بهینه وظایف طولانی‌مدت کمک می‌کند.

  

---

  

## `suspend` چیست و هدف آن در کوروتین‌ها چیست؟

  

تابع `suspend` یک نوع خاص از توابع است که می‌تواند اجرای خود را بدون مسدود کردن ترد فعلی متوقف کند.  

هدف اصلی `suspend` تسهیل اجرای غیرمسدودکننده و هم‌زمان در کدهای غیرهمگام است. این ویژگی باعث می‌شود اپلیکیشن‌ها عملکرد بهتری داشته و پاسخگوتر باشند.  

[منبع](https://www.geeksforgeeks.org/suspend-function-in-kotlin-coroutines/)

  

---

  

## چگونه و کجا از `suspend` به‌صورت مؤثر استفاده کنیم؟

  

- ****تعریف عملیات طولانی یا غیرهمگام:****  

  از کلمه کلیدی `suspend` برای ایجاد توابعی استفاده کنید که عملیات‌هایی مانند درخواست‌های شبکه یا دسترسی به پایگاه داده انجام می‌دهند، به‌طوری‌که بتوان این توابع را در کوروتین‌ها بدون مسدود کردن ترد صدا زد.

  

- ****فراخوانی در کوروتین‌ها یا توابع معلق دیگر:****  

  توابع `suspend` فقط می‌توانند از داخل یک کوروتین یا یک تابع `suspend` دیگر فراخوانی شوند. این موضوع تضمین می‌کند که فرآیند توقف و از سرگیری تابع به درستی مدیریت شود.  

[منبع](https://www.geeksforgeeks.org/suspend-function-in-kotlin-coroutines/)

  

---

  

## مثال: دریافت اطلاعات کاربر

  

```kotlin

suspend fun fetchUserData(userId: String): User {

    // شبیه‌سازی یک درخواست شبکه

    delay(1000) // متوقف کردن کوروتین برای یک ثانیه

    return User(userId, "John Doe")

}

  

fun main() = runBlocking {

    val user = fetchUserData("123")

    println(user)

}

  
```

**توضیحات:**

• تابع fetchUserData یک تابع suspend است که با استفاده از delay اجرای خود را به مدت یک ثانیه متوقف می‌کند.

• تابع main از runBlocking برای اجرای یک کوروتین استفاده می‌کند که تابع fetchUserData را صدا می‌زند.

• خروجی:

  

User(id=123, name=John Doe)

  

**درک نقاط تعلیق (Suspension Points)**

  

نقاط تعلیق مکان‌هایی در یک تابع suspend هستند که تابع می‌تواند اجرای خود را متوقف کند. در این نقاط:

• حالت فعلی کوروتین ذخیره می‌شود.

• کنترل ترد به عملیات دیگر داده می‌شود.

• پس از اتمام عملیات تعلیقی، کوروتین از همان نقطه از سر گرفته می‌شود.

[منبع](https://reflectoring.io/understanding-kotlin-coroutines-tutorial/)

  

**اشتباهات و تصورات غلط رایج**

• **اشتباه در رفتار غیرمسدودکننده:**

تصور غلط رایجی این است که فراخوانی یک تابع suspend آن را به طور خودکار روی یک ترد پس‌زمینه اجرا می‌کند. در واقع، suspend تنها امکان تعلیق را فراهم می‌کند و مشخص نمی‌کند که اجرا روی کدام ترد انجام شود. برای این کار باید از کانتکست‌های مشخص مانند Dispatchers.IO استفاده کنید.

• **فراخوانی از کد غیرمعلق:**

اگر سعی کنید یک تابع suspend را از کد غیرمعلق فراخوانی کنید، با خطای کامپایل مواجه خواهید شد. مطمئن شوید که این توابع تنها از داخل کوروتین‌ها صدا زده شوند.

[منبع](https://www.geeksforgeeks.org/suspend-function-in-kotlin-coroutines/)

• **مسدود کردن ترد اصلی:**

اگر توابع suspend به درستی مدیریت نشوند، ممکن است باعث مسدود شدن ترد اصلی شوند و در نتیجه باعث کاهش کارایی و گیر کردن رابط کاربری شوند.

[منبع](https://medium.com/%40husayn.fakher/working-with-coroutines-overlooked-errors-to-watch-for-b31692073bea)

  

**بهترین روش‌ها**

1. **ایمن‌سازی ترد اصلی:**

توابع معلق باید ایمن برای فراخوانی از ترد اصلی باشند. اگر تابعی عملیات طولانی انجام می‌دهد، از withContext(Dispatchers.IO) برای انتقال آن به ترد پس‌زمینه استفاده کنید.

[منبع](https://developer.android.com/kotlin/coroutines/coroutines-best-practices)

2. **رعایت همزمانی ساختاری (Structured Concurrency):**

برای مدیریت چرخه حیات کوروتین‌ها از اصول همزمانی ساختاری استفاده کنید و مطمئن شوید که کوروتین‌ها در یک محدوده (Scope) با کنترل صحیح اجرا و لغو شوند.

[منبع](https://kotlinlang.org/docs/composing-suspending-functions.html)

3. **مدیریت استثناها:**

برای جلوگیری از خطاهای غیرمنتظره و مدیریت منابع، به مدیریت استثناها در توابع suspend توجه کنید.

  

با رعایت این نکات می‌توانید به صورت مؤثر از کلمه کلیدی suspend در کوروتین‌های کاتلین استفاده کرده و کدی کارا، پاسخگو و قابل نگهداری بنویسید.